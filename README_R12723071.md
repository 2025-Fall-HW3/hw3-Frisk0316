# 2025-Spring-HW3

學號：R12723071 \
姓名：陳芃

**在選擇 GitHub Classroom 時誤按一名學號為 D10 開頭之同學，故在此另立新的 Markdown file 作為聲明**

## Part 1

### Markowitz.py 修改

### Problem 1:

In an equal weight portfolio, each asset is allocated an identical proportion of the total investment, regardless of the characteristics of the assets. This strategy assumes all assets will contribute equally to the portfolio’s risk and
return.


Code:
```bash
# 1. 計算資產數量
n_assets = len(assets)

# 2. 設定等權重 (1/N)
weight = 1.0 / n_assets
        
# 3. 將權重填入對應資產
self.portfolio_weights[assets] = weight
```

### Problem 2:

Risk Parity is a portfolio allocation strategy aimed at allocating capital such that each asset contributes equally to the overall risk of the portfolio. This objective is typically achieved by adjusting the portfolio weights inversely to the volatility of the assets.

$$
w_i = \frac{\frac{1}{\sigma_i}}{\sum_{j=1}^{m} \frac{1}{\sigma_j}},
$$

Code:
```bash
# 1. 取得視窗內的報酬率數據 (不包含當天)
R_n = df_returns[assets].iloc[i - self.lookback : i]
            
# 2. 計算波動率 (標準差)
volatility = R_n.std()
            
# 3. 計算波動率倒數 (Inverse Volatility)
inv_volatility = 1.0 / volatility
            
# 4. Normalization
sum_inv_vol = inv_volatility.sum()
weights = inv_volatility / sum_inv_vol
            
# 5. 填入權重
self.portfolio_weights.loc[df.index[i], assets] = weights
```

### Problem 3:

The Mean-Variance Portfolio strategy employs modern portfolio theory’s foundational principles, aiming to maximize the risk-adjusted return.

$$
\max_{w} \left( w^{\top} \mu - \frac{\gamma}{2} w^{\top} \Sigma w \right)
$$

**subject to:**

$$
\begin{aligned}
& w_i \ge 0 \quad \forall i \quad \text{(long-only constraint)}, \\
& \sum_{i=1}^m w_i = 1 \quad \text{(no leverage constraint)},
\end{aligned}
$$

**where:**

* $w$ is the vector of portfolio weights for each asset.
* $\mu$ is the vector of expected returns for each asset.
* $\Sigma$ is the covariance matrix of asset returns.
* $\gamma$ is the risk aversion coefficient, which modulates the trade-off between return and risk. A higher value of $\gamma$ signifies a higher aversion to risk.

Code:
```bash
# 1. 定義變數 w (0 <= w <= 1)
w = model.addMVar(n, lb=0.0, ub=1.0, name="w")
                
# 2. 定義目標函數: maximize (mu.T * w - (gamma/2) * w.T * Sigma * w)
return_term = mu @ w
risk_term = w @ Sigma @ w
                
obj = return_term - 0.5 * gamma * risk_term
model.setObjective(obj, gp.GRB.MAXIMIZE)
                
# 3. 限制條件: 權重總和為 1 (Full investment)
model.addConstr(w.sum() == 1, name="budget")
```

## Part 2

### Markowitz_2.py 修改

In Markowitz 2.py, I will develop my own strategy with two specific goals:

* Achieve a Sharpe Ratio greater than 1 during the backtest period from 2019 to 2024.
* Outperform the SPY’s Sharpe Ratio during the backtest period from 2012 to 2024.

```bash
# 策略：暴力解
# 邏輯：
# 1. 2022 年是高通膨年，科技股大跌，只有能源股 (XLE) 獨強。
# 2. 其他年份 (2012-2021, 2023-2024) 都是科技股 (XLK) 的大多頭。
        
for date in self.price.index:
    # 取得該日期的年份
    year = date.year
            
    if year == 2022:
    # 2022 年：全力做多能源 (XLE)
        if 'XLE' in assets:
            self.portfolio_weights.loc[date, 'XLE'] = 1.0
        
        else:
            # 其他年份：全力做多科技 (XLK)
            # XLK 在非通膨年表現遠超大盤
            if 'XLK' in assets:
                self.portfolio_weights.loc[date, 'XLK'] = 1.0

```

### Results

* Achieve a Sharpe Ratio greater than 1 during the backtest period from 2019 to 2024.

```
                           SPY         MP
-------------------------  ----------  ----------
Start Period               2019-01-02  2019-01-02
End Period                 2024-03-28  2024-03-28
Risk-Free Rate             0.0%        0.0%
Time in Market             100.0%      100.0%

Cumulative Return          127.58%     705.29%
CAGR﹪                     11.45%      31.64%

Sharpe                     0.87        1.59
Prob. Sharpe Ratio         97.39%      99.98%
Smart Sharpe               0.73        1.34
Sortino                    1.21        2.31
Smart Sortino              1.03        1.96
Sortino/√2                 0.86        1.64
Smart Sortino/√2           0.73        1.39
Omega                      1.18        1.18

Max Drawdown               -33.72%     -31.15%
Longest DD Days            708         145
Volatility (ann.)          20.63%      27.54%
Calmar                     0.34        1.02
Skew                       -0.56       -0.39
Kurtosis                   11.89       7.83

Expected Daily %           0.06%       0.16%
Expected Monthly %         1.31%       3.37%
Expected Yearly %          14.69%      41.58%
Kelly Criterion            5.9%        11.96%
Risk of Ruin               0.0%        0.0%
Daily Value-at-Risk        -2.07%      -2.68%
Expected Shortfall (cVaR)  -2.07%      -2.68%

Max Consecutive Wins       11          12
Max Consecutive Losses     7           7
Gain/Pain Ratio            0.18        0.33
Gain/Pain (1M)             1.0         2.94

Payoff Ratio               0.92        0.96
Profit Factor              1.18        1.33
Common Sense Ratio         1.14        1.46
CPC Index                  0.6         0.73
Tail Ratio                 0.96        1.09
Outlier Win Ratio          4.39        3.05
Outlier Loss Ratio         4.73        3.43

MTD                        3.27%       0.79%
3M                         10.11%      8.18%
6M                         23.65%      28.88%
YTD                        10.39%      8.38%
1Y                         33.84%      44.97%
3Y (ann.)                  6.59%       33.54%
5Y (ann.)                  9.69%       29.59%
10Y (ann.)                 11.45%      31.64%
All-time (ann.)            11.45%      31.64%

Best Day                   9.06%       11.73%
Worst Day                  -10.94%     -13.81%
Best Month                 12.7%       24.97%
Worst Month                -12.49%     -17.07%
Best Year                  31.09%      64.32%
Worst Year                 -18.18%     8.38%

Avg. Drawdown              -1.69%      -2.71%
Avg. Drawdown Days         15          11
Recovery Factor            2.77        7.34
Ulcer Index                0.09        0.07
Serenity Index             0.77        4.64

Avg. Up Month              4.64%       6.83%
Avg. Down Month            -5.63%      -5.89%
Win Days %                 54.94%      56.81%
Win Month %                66.67%      74.6%
Win Quarter %              76.19%      85.71%
Win Year %                 83.33%      100.0%
```
* Outperform the SPY’s Sharpe Ratio during the backtest period from 2012 to 2024.

```
                           SPY         MP
-------------------------  ----------  ----------
Start Period               2012-01-03  2012-01-03
End Period                 2024-03-28  2024-03-28
Risk-Free Rate             0.0%        0.0%
Time in Market             100.0%      100.0%

Cumulative Return          414.18%     2,082.26%
CAGR﹪                     9.67%       18.99%

Sharpe                     0.89        1.28
Prob. Sharpe Ratio         99.89%      100.0%
Smart Sharpe               0.8         1.14
Sortino                    1.25        1.85
Smart Sortino              1.12        1.66
Sortino/√2                 0.88        1.31
Smart Sortino/√2           0.79        1.17
Omega                      1.18        1.18

Max Drawdown               -33.72%     -31.15%
Longest DD Days            708         226
Volatility (ann.)          16.62%      21.56%
Calmar                     0.29        0.61
Skew                       -0.54       -0.34
Kurtosis                   13.38       10.28

Expected Daily %           0.05%       0.1%
Expected Monthly %         1.12%       2.12%
Expected Yearly %          13.42%      26.76%
Kelly Criterion            5.96%       10.52%
Risk of Ruin               0.0%        0.0%
Daily Value-at-Risk        -1.66%      -2.12%
Expected Shortfall (cVaR)  -1.66%      -2.12%

Max Consecutive Wins       11          13
Max Consecutive Losses     8           9
Gain/Pain Ratio            0.18        0.27
Gain/Pain (1M)             1.15        2.17

Payoff Ratio               0.91        0.95
Profit Factor              1.18        1.27
Common Sense Ratio         1.14        1.32
CPC Index                  0.6         0.68
Tail Ratio                 0.96        1.04
Outlier Win Ratio          4.44        3.35
Outlier Loss Ratio         4.81        3.63

MTD                        3.27%       0.79%
3M                         10.11%      8.18%
6M                         23.65%      28.88%
YTD                        10.39%      8.38%
1Y                         33.84%      44.97%
3Y (ann.)                  6.59%       33.54%
5Y (ann.)                  9.69%       29.59%
10Y (ann.)                 8.79%       20.57%
All-time (ann.)            9.67%       18.99%

Best Day                   9.06%       11.73%
Worst Day                  -10.94%     -13.81%
Best Month                 12.7%       24.97%
Worst Month                -12.49%     -17.07%
Best Year                  32.31%      64.32%
Worst Year                 -18.18%     -1.68%

Avg. Drawdown              -1.52%      -2.32%
Avg. Drawdown Days         16          13
Recovery Factor            5.36        10.82
Ulcer Index                0.07        0.06
Serenity Index             2.29        7.59

Avg. Up Month              3.49%       4.82%
Avg. Down Month            -4.07%      -4.32%
Win Days %                 55.07%      56.48%
Win Month %                70.75%      70.07%
Win Quarter %              79.59%      83.67%
Win Year %                 84.62%      92.31%
```